<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Matriks: Konsep Kereta & Tiang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        
        /* --- VISUAL ELEMENTS --- */
        .car-visual {
            display: flex;
            align-items: center;
            background: #e0f2fe; /* Sky 100 */
            border: 2px solid #0ea5e9; /* Sky 500 */
            border-radius: 12px;
            padding: 4px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: relative;
        }
        /* Roda Kereta hiasan */
        .car-visual::before, .car-visual::after {
            content: ''; position: absolute; bottom: -6px; width: 14px; height: 14px;
            background: #334155; border-radius: 50%; border: 2px solid #94a3b8; z-index: 10;
        }
        .car-visual::before { left: 10px; }
        .car-visual::after { right: 10px; }

        .pole-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fef9c3; /* Yellow 100 */
            border: 2px solid #eab308; /* Yellow 500 */
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: relative;
        }
        /* Lampu hiasan */
        .pole-visual::before {
            content: '\f0eb'; font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; top: -20px; color: #eab308; font-size: 16px;
        }
        /* Tapak tiang */
        .pole-visual::after {
            content: ''; position: absolute; bottom: -8px; width: 20px; height: 6px;
            background: #475569; border-radius: 4px;
        }

        .num-box {
            width: 36px; height: 36px;
            display: flex; justify-content: center; align-items: center;
            font-weight: 800; font-size: 1.1rem;
            background: white; border: 1px solid #cbd5e1;
            margin: 2px; border-radius: 4px; z-index: 5;
        }

        /* --- RESULT MATRIX STYLES --- */
        .big-bracket {
            border-left: 5px solid #1e293b;
            border-right: 5px solid #1e293b;
            border-radius: 20px;
            padding: 10px;
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .big-bracket::before, .big-bracket::after {
            content: ''; position: absolute; width: 20px; height: 5px; background-color: #1e293b;
        }
        .big-bracket::before { top: -2.5px; left: -2.5px; } /* Top Left */
        .big-bracket::after { bottom: -2.5px; left: -2.5px; } /* Bottom Left */
        
        .big-bracket .tr { position: absolute; top: -2.5px; right: -2.5px; width: 20px; height: 5px; background: #1e293b; }
        .big-bracket .br { position: absolute; bottom: -2.5px; right: -2.5px; width: 20px; height: 5px; background: #1e293b; }

        .placeholder-cell {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            background: #f8fafc;
            display: flex; justify-content: center; align-items: center;
            position: relative;
            transition: all 0.3s;
        }
        
        .final-answer {
            font-size: 2rem; font-weight: 900; color: #16a34a;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- ANIMATION LAYER --- */
        #animation-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
        }
        .flying-el {
            position: absolute; transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
            transform-origin: center center;
            z-index: 50;
        }

        /* Math formula popup */
        .math-popup {
            position: absolute;
            background: #1e293b; color: #4ade80;
            padding: 6px 12px; border-radius: 6px;
            font-family: 'Courier New', monospace; font-weight: bold; font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0; transform: translateY(10px);
            transition: all 0.3s; z-index: 60;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        .math-popup.show { opacity: 1; transform: translateY(0); }

        .input-config { border: 2px solid #e2e8f0; padding: 5px; border-radius: 6px; font-weight: bold; width: 60px; text-align: center; }
        .btn-primary { background: #2563eb; color: white; padding: 10px 24px; border-radius: 50px; font-weight: bold; transition: 0.2s; box-shadow: 0 4px 6px rgba(37,99,235,0.3); }
        .btn-primary:hover { background: #1d4ed8; transform: translateY(-2px); }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Highlight during animation */
        .highlight-calc {
            animation: pulse-yellow 1s infinite;
            border-color: #f59e0b !important;
            background-color: #fef3c7 !important;
        }
        @keyframes pulse-yellow {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body class="flex flex-col min-h-screen text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 p-4 sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-black text-slate-700"><i class="fas fa-cube text-blue-600 mr-2"></i>Matriks Visual</h1>
            <div class="text-xs font-bold bg-slate-100 px-3 py-1 rounded-full text-slate-500">Mod Simulasi</div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 flex flex-col items-center justify-center">

        <!-- STEP 1: CONFIG & INPUT -->
        <div id="setup-panel" class="bg-white p-6 rounded-2xl shadow-xl border border-slate-100 max-w-4xl w-full">
            <h2 class="text-2xl font-bold mb-6 text-center">Tetapan Matriks</h2>
            
            <!-- Matrix Sizes -->
            <div class="flex justify-center gap-4 mb-6 items-center">
                <div class="text-center p-3 bg-blue-50 rounded-lg">
                    <div class="text-xs text-blue-600 font-bold mb-1">Matriks A</div>
                    <select id="rowA" class="input-config">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                    </select>
                    <span class="font-bold text-slate-400 mx-1">x</span>
                    <select id="colA" class="input-config">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="text-xl font-bold text-slate-300">X</div>
                <div class="text-center p-3 bg-yellow-50 rounded-lg">
                    <div class="text-xs text-yellow-600 font-bold mb-1">Matriks B</div>
                    <select id="rowB" class="input-config bg-slate-100" disabled>
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                    </select>
                    <span class="font-bold text-slate-400 mx-1">x</span>
                    <select id="colB" class="input-config">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                    </select>
                </div>
            </div>

            <!-- Matrix Inputs -->
            <div class="flex flex-wrap justify-center gap-8 mb-8">
                <div>
                    <div class="text-center text-xs font-bold text-slate-400 mb-2">INPUT A (Kereta)</div>
                    <div id="inputGridA" class="grid gap-2 p-2 bg-slate-50 rounded-lg border border-slate-200"></div>
                </div>
                <div>
                    <div class="text-center text-xs font-bold text-slate-400 mb-2">INPUT B (Tiang)</div>
                    <div id="inputGridB" class="grid gap-2 p-2 bg-slate-50 rounded-lg border border-slate-200"></div>
                </div>
            </div>

            <div class="text-center">
                <button onclick="initSimulation()" class="btn-primary">
                    Bina & Mula Simulasi <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- STEP 2: SIMULATION STAGE (Hidden initially) -->
        <div id="sim-stage" class="hidden w-full max-w-6xl">
            
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
                
                <!-- LEFT PANEL: SOURCE (A & B) -->
                <div class="lg:col-span-5 flex flex-col justify-center">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 relative min-h-[400px] flex flex-col justify-center">
                        <div class="absolute top-4 left-4 text-xs font-bold text-slate-400 tracking-widest">PUNCA (SOURCE)</div>
                        
                        <div class="flex justify-between items-center px-4">
                            <!-- Matriks A (Stack of Cars) -->
                            <div id="sourceA" class="flex flex-col gap-4 items-end">
                                <!-- Cars injected here -->
                            </div>

                            <div class="text-2xl font-black text-slate-200 mx-4">X</div>

                            <!-- Matriks B (Row of Poles) -->
                            <div id="sourceB" class="flex gap-4 items-start">
                                <!-- Poles injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MIDDLE: ARROW (Desktop only) -->
                <div class="hidden lg:flex lg:col-span-1 flex-col justify-center items-center">
                    <i class="fas fa-arrow-right text-4xl text-slate-200 animate-pulse"></i>
                </div>

                <!-- RIGHT PANEL: RESULT (C) -->
                <div class="lg:col-span-6 flex flex-col justify-center">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 min-h-[400px] flex flex-col items-center justify-center relative">
                        <div class="absolute top-4 left-4 text-xs font-bold text-slate-400 tracking-widest">HASIL (RESULT)</div>
                        
                        <div class="flex items-center">
                            <span class="text-4xl font-black text-slate-300 mr-4">=</span>
                            
                            <div class="big-bracket">
                                <span class="tr"></span><span class="br"></span>
                                <!-- Result Grid -->
                                <div id="resultGrid" class="grid gap-6">
                                    <!-- Placeholders injected here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="instruction-text" class="absolute bottom-4 text-slate-400 text-sm font-bold animate-pulse">
                            Tekan butang untuk mula...
                        </div>
                    </div>
                </div>

            </div>

            <!-- CONTROLS -->
            <div class="fixed bottom-8 left-0 width-full w-full flex justify-center z-50 pointer-events-none">
                <div class="bg-white/90 backdrop-blur p-2 rounded-full shadow-2xl border border-slate-200 pointer-events-auto flex gap-3">
                    <button id="btn-back" onclick="resetToSetup()" class="px-6 py-3 rounded-full font-bold text-slate-500 hover:bg-slate-100">
                        Ubah Matriks
                    </button>
                    <button id="btn-next" onclick="nextStep()" class="btn-primary min-w-[200px]">
                        Langkah Seterusnya
                    </button>
                </div>
            </div>

        </div>

    </main>
    
    <!-- This layer holds the flying cars/poles -->
    <div id="animation-layer"></div>

    <script>
        // DATA STATE
        let matrixA = [[1, 2], [3, 4]];
        let matrixB = [[5, 6], [7, 8]];
        let config = { rA: 2, cA: 2, rB: 2, cB: 2 };
        let steps = [];
        let currentStepIdx = 0;
        let isAnimating = false;

        // ELEMENT REFERENCES
        const setupPanel = document.getElementById('setup-panel');
        const simStage = document.getElementById('sim-stage');
        const animLayer = document.getElementById('animation-layer');

        // --- INIT & SETUP ---
        
        document.getElementById('colA').addEventListener('change', (e) => {
            const val = e.target.value;
            document.getElementById('rowB').value = val;
            renderInputs();
        });
        document.getElementById('rowA').addEventListener('change', renderInputs);
        document.getElementById('colB').addEventListener('change', renderInputs);

        function renderInputs() {
            config.rA = parseInt(document.getElementById('rowA').value);
            config.cA = parseInt(document.getElementById('colA').value);
            config.rB = parseInt(document.getElementById('rowB').value);
            config.cB = parseInt(document.getElementById('colB').value);

            const gridA = document.getElementById('inputGridA');
            const gridB = document.getElementById('inputGridB');

            gridA.style.gridTemplateColumns = `repeat(${config.cA}, 1fr)`;
            gridB.style.gridTemplateColumns = `repeat(${config.cB}, 1fr)`;

            gridA.innerHTML = '';
            gridB.innerHTML = '';

            for(let r=0; r<config.rA; r++) {
                for(let c=0; c<config.cA; c++) {
                    gridA.innerHTML += `<input type="number" id="a-${r}-${c}" class="w-10 h-10 text-center border rounded bg-white" value="${Math.floor(Math.random()*5)+1}">`;
                }
            }
            for(let r=0; r<config.rB; r++) {
                for(let c=0; c<config.cB; c++) {
                    gridB.innerHTML += `<input type="number" id="b-${r}-${c}" class="w-10 h-10 text-center border rounded bg-white" value="${Math.floor(Math.random()*5)+1}">`;
                }
            }
        }

        // Initialize on load
        renderInputs();

        function initSimulation() {
            // 1. Read Values
            matrixA = [];
            for(let r=0; r<config.rA; r++) {
                let row = [];
                for(let c=0; c<config.cA; c++) {
                    row.push(parseInt(document.getElementById(`a-${r}-${c}`).value) || 0);
                }
                matrixA.push(row);
            }

            matrixB = [];
            for(let r=0; r<config.rB; r++) {
                let row = [];
                for(let c=0; c<config.cB; c++) {
                    row.push(parseInt(document.getElementById(`b-${r}-${c}`).value) || 0);
                }
                matrixB.push(row);
            }

            // 2. Prepare UI
            setupPanel.classList.add('hidden');
            simStage.classList.remove('hidden');
            
            // 3. Render Source Views
            const containerA = document.getElementById('sourceA');
            containerA.innerHTML = '';
            matrixA.forEach((row, i) => {
                const carDiv = document.createElement('div');
                carDiv.className = 'car-visual';
                carDiv.id = `src-car-${i}`;
                row.forEach(num => {
                    carDiv.innerHTML += `<div class="num-box text-blue-600">${num}</div>`;
                });
                containerA.appendChild(carDiv);
            });

            const containerB = document.getElementById('sourceB');
            containerB.innerHTML = '';
            // Transpose loop to render columns visually side-by-side
            for(let c=0; c<config.cB; c++) {
                const poleDiv = document.createElement('div');
                poleDiv.className = 'pole-visual';
                poleDiv.id = `src-pole-${c}`;
                for(let r=0; r<config.rB; r++) {
                    poleDiv.innerHTML += `<div class="num-box text-yellow-600 bg-yellow-50">${matrixB[r][c]}</div>`;
                }
                containerB.appendChild(poleDiv);
            }

            // 4. Render Result Grid
            const resGrid = document.getElementById('resultGrid');
            resGrid.style.gridTemplateColumns = `repeat(${config.cB}, 1fr)`;
            resGrid.innerHTML = '';
            
            // Calculate Layout Size
            // If matrix is large, reduce gaps
            const gap = config.cB > 2 ? '10px' : '30px';
            resGrid.style.gap = gap;

            for(let r=0; r<config.rA; r++) {
                for(let c=0; c<config.cB; c++) {
                    const placeholder = document.createElement('div');
                    placeholder.className = 'placeholder-cell';
                    // Dynamic sizing based on content
                    const width = (config.cA * 40) + 40; // Approx width of car
                    const height = (config.cA * 40) + 60; // Extra height for displaying both rows
                    placeholder.style.width = `${width}px`;
                    placeholder.style.height = `${height}px`;
                    placeholder.id = `target-${r}-${c}`;
                    resGrid.appendChild(placeholder);
                }
            }

            // 5. Generate Steps
            steps = [];
            for(let r=0; r<config.rA; r++) {
                for(let c=0; c<config.cB; c++) {
                    steps.push({ r, c });
                }
            }
            currentStepIdx = 0;
            updateBtnState();
            document.getElementById('instruction-text').textContent = "Sedia untuk mendarab...";
        }

        function resetToSetup() {
            simStage.classList.add('hidden');
            setupPanel.classList.remove('hidden');
            animLayer.innerHTML = '';
        }

        // --- ANIMATION CORE ---

        async function nextStep() {
            if(isAnimating || currentStepIdx >= steps.length) return;
            
            isAnimating = true;
            updateBtnState();
            
            const step = steps[currentStepIdx];
            const targetCell = document.getElementById(`target-${step.r}-${step.c}`);
            const srcCar = document.getElementById(`src-car-${step.r}`);
            const srcPole = document.getElementById(`src-pole-${step.c}`);

            // 1. Clone Elements for Flying
            const flyingCar = srcCar.cloneNode(true);
            const flyingPole = srcPole.cloneNode(true);
            
            // Position Clones at Source
            const carRect = srcCar.getBoundingClientRect();
            const poleRect = srcPole.getBoundingClientRect();
            const targetRect = targetCell.getBoundingClientRect();

            setFixedPos(flyingCar, carRect);
            setFixedPos(flyingPole, poleRect);
            
            flyingCar.classList.add('flying-el');
            flyingPole.classList.add('flying-el');
            
            animLayer.appendChild(flyingCar);
            animLayer.appendChild(flyingPole);

            // Highlight Originals
            srcCar.style.opacity = '0.3';
            srcPole.style.opacity = '0.3';

            document.getElementById('instruction-text').textContent = `Mendarab Baris ${step.r+1} dengan Lajur ${step.c+1}...`;

            // --- ANIMATION SEQUENCE ---

            await wait(100);

            // 2. Fly to Target
            // Car goes to bottom of cell area (visually)
            const centerX = targetRect.left + (targetRect.width/2);
            const centerY = targetRect.top + (targetRect.height/2);

            // Car Target: Centered horizontally, slightly lower
            // We shift car DOWN a bit (+20) to make room for pole above
            const carTargetX = centerX - (carRect.width/2);
            const carTargetY = centerY + 20; 
            
            // Pole Target: Centered horizontally, starts above car
            const poleTargetX = centerX - (poleRect.width/2);
            const poleTargetY = carTargetY - poleRect.height - 40;

            flyingCar.style.transform = `translate(${carTargetX - carRect.left}px, ${carTargetY - carRect.top}px)`;
            flyingPole.style.transform = `translate(${poleTargetX - poleRect.left}px, ${poleTargetY - poleRect.top}px)`;

            await wait(1000); // Wait for flight

            // 3. THE CRASH (Pole Rotates & Lands ABOVE Car)
            // Rotate pole 90deg counter-clockwise to lie flat
            // Pole: [Top, Bottom] -> Rotate -90 -> [Top(Left), Bottom(Right)]
            
            // Goal: Move Pole center to Car center, but SHIFT UP by ~50px
            // Current Pole Pos: poleTargetX, poleTargetY
            // Car Pos: carTargetX, carTargetY
            
            const deltaX = (carTargetX + carRect.width/2) - (poleTargetX + poleRect.width/2);
            const deltaY = (carTargetY + carRect.height/2) - (poleTargetY + poleRect.height/2);
            
            const finalPoleX = (poleTargetX - poleRect.left) + deltaX;
            // CHANGE: Increased negative offset to -55px to ensure NO overlap
            const finalPoleY = (poleTargetY - poleRect.top) + deltaY - 55; 

            flyingPole.style.transform = `translate(${finalPoleX}px, ${finalPoleY}px) rotate(-90deg)`;
            flyingPole.style.boxShadow = "0 10px 20px rgba(0,0,0,0.1)"; 

            await wait(800);

            // 4. MATH POPUP
            const rowData = matrixA[step.r];
            const colData = []; 
            for(let r=0; r<config.rB; r++) colData.push(matrixB[r][step.c]);
            
            let sum = 0;
            let equation = "";
            rowData.forEach((val, i) => {
                const bVal = colData[i];
                sum += val * bVal;
                equation += `(${val}Ã—${bVal}) ${i < rowData.length-1 ? '+' : ''} `;
            });
            equation += `= ${sum}`;

            const popup = document.createElement('div');
            popup.className = 'math-popup';
            popup.innerHTML = equation;
            // Position popup below car
            const popupX = carTargetX + (carRect.width/2) - 80; // Approximate centering
            const popupY = carTargetY + carRect.height + 20;
            popup.style.left = `${popupX}px`;
            popup.style.top = `${popupY}px`;
            
            animLayer.appendChild(popup);
            
            // Trigger animation
            requestAnimationFrame(() => popup.classList.add('show'));

            await wait(1500);

            // 5. FINISH
            // Fade out flying elements
            flyingCar.style.opacity = '0';
            flyingPole.style.opacity = '0';
            popup.style.opacity = '0';
            
            // Show result in grid
            targetCell.innerHTML = `<span class="final-answer">${sum}</span>`;
            targetCell.style.border = "2px solid #22c55e";
            targetCell.style.background = "#dcfce7";

            await wait(500);

            // Cleanup
            animLayer.innerHTML = '';
            srcCar.style.opacity = '1';
            srcPole.style.opacity = '1';

            currentStepIdx++;
            isAnimating = false;
            updateBtnState();

            if(currentStepIdx >= steps.length) {
                document.getElementById('instruction-text').innerHTML = `<span class="text-green-500 text-lg"><i class="fas fa-check-circle"></i> Selesai!</span>`;
            } else {
                document.getElementById('instruction-text').textContent = "Tekan Langkah Seterusnya...";
            }
        }

        // --- UTILS ---

        function setFixedPos(el, rect) {
            el.style.left = `${rect.left}px`;
            el.style.top = `${rect.top}px`;
            el.style.width = `${rect.width}px`;
            el.style.height = `${rect.height}px`;
            el.style.margin = '0';
        }

        function updateBtnState() {
            const btn = document.getElementById('btn-next');
            if(currentStepIdx >= steps.length) {
                btn.textContent = "Selesai";
                btn.disabled = true;
                btn.classList.add('bg-green-600');
            } else {
                btn.textContent = `Langkah ${currentStepIdx + 1} / ${steps.length}`;
                btn.disabled = isAnimating;
            }
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

    </script>
</body>
</html>